# Internationalization (i18n) Guidelines

### CRITICAL i18n ACTION ITEMS

Based on lessons learned from production i18n issues, follow these mandatory steps:

#### **ğŸ” BEFORE Writing New UI Components**
1. **Check existing translation modules** in `/apps/web/lib/i18n/translations/`
2. **Plan translation keys** before writing hardcoded text
3. **Use descriptive key names** following pattern: `namespace.specificFunction`
4. **Import useI18n hook** at component start: `const { t } = useI18n()`

#### **âœ… DURING Component Development**  
1. **NEVER write hardcoded Chinese/English text** in JSX
2. **Always use t() function**: `{t('namespace.key')}` instead of `'ç¡¬ç·¨ç¢¼æ–‡å­—'`
3. **Create translation keys immediately** when adding text content
4. **Test both languages** during development, not just at the end

#### **ğŸ§ª MANDATORY Testing for i18n**
1. **Create translation consistency tests** for new modules
2. **Test parameter interpolation** (e.g., `{count}`, `{duration}`)
3. **Verify both Chinese and English** have matching key coverage
4. **Run build tests** to catch missing translation keys early

#### **ğŸ“‹ i18n Code Review Checklist**
- [ ] No hardcoded Chinese/English strings in JSX
- [ ] All translation keys exist in both `zh` and `en` objects
- [ ] Parameter interpolation works correctly
- [ ] useI18n hook properly imported and used
- [ ] Translation keys follow naming convention
- [ ] Both languages tested and working

#### **ğŸš¨ Common i18n Pitfalls to Avoid**
1. **Incomplete English translations** - Always complete both languages
2. **Missing translation module imports** - Update `/lib/i18n/index.ts`
3. **Hardcoded text in alerts/messages** - Use t() for all user-facing text
4. **Forgotten interpolation parameters** - Test dynamic content
5. **Language switcher not fully translated** - Include all UI elements

#### **ğŸ”§ i18n Debugging Steps**
1. Check browser console for missing translation key warnings
2. Verify translation key exists in both languages
3. Confirm translation module is imported in `index.ts`
4. Test language switching functionality
5. Run translation tests: `npm test -- --testPathPattern="i18n"`

#### **ğŸ“ Translation Key Naming Convention**
```typescript
// âœ… Good - Descriptive and specific
'sessions.exportFormat': 'åŒ¯å‡ºæ ¼å¼'
'sessions.uploadSuccess': 'ä¸Šå‚³æˆåŠŸï¼å·²å»ºç«‹ {count} å€‹ç‰‡æ®µ'
'auth.passwordMismatch': 'å¯†ç¢¼ä¸ç¬¦'

// âŒ Bad - Generic or unclear  
'format': 'æ ¼å¼'
'success': 'æˆåŠŸ'
'error': 'éŒ¯èª¤'
```

#### **ğŸ¯ Module Organization**
- `auth.ts` - Authentication, login, signup
- `sessions.ts` - Session management, transcripts
- `clients.ts` - Client management
- `landing.ts` - Homepage content
- `common.ts` - Shared UI elements (buttons, labels)
- `nav.ts` - Navigation, menus

## Implementation Architecture

### Project Structure
```
apps/web/lib/i18n/
â”œâ”€â”€ index.ts                    # Main i18n configuration
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ i18n-context.tsx       # React context for language state
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useI18n.ts             # Hook for accessing translations
â””â”€â”€ translations/              # Translation modules
    â”œâ”€â”€ auth.ts                # Authentication related
    â”œâ”€â”€ sessions.ts            # Session management
    â”œâ”€â”€ clients.ts             # Client management
    â”œâ”€â”€ landing.ts             # Landing page content
    â”œâ”€â”€ common.ts              # Shared UI elements
    â””â”€â”€ nav.ts                 # Navigation elements
```

### Usage Examples

**Basic Translation:**
```typescript
import { useI18n } from '@/lib/i18n/hooks/useI18n';

function MyComponent() {
  const { t } = useI18n();
  
  return (
    <div>
      <h1>{t('sessions.title')}</h1>
      <button>{t('common.save')}</button>
    </div>
  );
}
```

**Parameter Interpolation:**
```typescript
// Translation keys with parameters
'sessions.uploadSuccess': 'ä¸Šå‚³æˆåŠŸï¼å·²å»ºç«‹ {count} å€‹ç‰‡æ®µ'
'sessions.conversationSummary': 'ç¸½æ™‚é•·: {duration} | {count} æ®µå°è©±'

// Usage with parameters
{t('sessions.uploadSuccess', { count: segments.length })}
{t('sessions.conversationSummary', { duration: '30:45', count: 15 })}
```

**Conditional Content:**
```typescript
// Use translation keys for conditional content
const statusText = isProcessing 
  ? t('sessions.processing') 
  : t('sessions.completed');
```

### Testing Strategy

**Translation Consistency Tests:**
```typescript
// Test all keys have both languages
describe('Translation Consistency', () => {
  it('should have matching keys for Chinese and English', () => {
    const zhKeys = Object.keys(translations.zh);
    const enKeys = Object.keys(translations.en);
    
    zhKeys.forEach(key => {
      expect(enKeys).toContain(key);
      expect(translations.en[key]).toBeDefined();
      expect(translations.en[key]).not.toBe('');
    });
  });
});
```

**Functional i18n Tests:**
```typescript
// Test component renders correctly in both languages
describe('Component i18n', () => {
  it('should render Chinese translations correctly', () => {
    render(
      <I18nProvider initialLanguage="zh">
        <MyComponent />
      </I18nProvider>
    );
    
    expect(screen.getByText('æœƒè«‡æ¦‚è¦½')).toBeInTheDocument();
  });
  
  it('should render English translations correctly', () => {
    render(
      <I18nProvider initialLanguage="en">
        <MyComponent />
      </I18nProvider>
    );
    
    expect(screen.getByText('Overview')).toBeInTheDocument();
  });
});
```

## Development Workflow

### Adding New Translations

1. **Identify Translation Namespace:**
   - Choose appropriate module (auth, sessions, clients, etc.)
   - If no suitable module exists, create new one

2. **Add Translation Keys:**
   ```typescript
   // In /apps/web/lib/i18n/translations/sessions.ts
   export const sessionsTranslations = {
     zh: {
       'sessions.newFeature': 'æ–°åŠŸèƒ½',
       'sessions.newFeatureDesc': 'é€™æ˜¯ä¸€å€‹æ–°åŠŸèƒ½ï¼Œæ”¯æ´ {type} é¡å‹'
     },
     en: {
       'sessions.newFeature': 'New Feature',
       'sessions.newFeatureDesc': 'This is a new feature that supports {type} type'
     }
   };
   ```

3. **Update Main Index:**
   ```typescript
   // In /apps/web/lib/i18n/index.ts
   import { sessionsTranslations } from './translations/sessions';
   
   export const translations = {
     zh: {
       ...sessionsTranslations.zh,
     },
     en: {
       ...sessionsTranslations.en,
     }
   };
   ```

4. **Use in Components:**
   ```typescript
   const { t } = useI18n();
   return <span>{t('sessions.newFeature')}</span>;
   ```

5. **Add Tests:**
   ```typescript
   it('should have new feature translations', () => {
     expect(translations.zh['sessions.newFeature']).toBe('æ–°åŠŸèƒ½');
     expect(translations.en['sessions.newFeature']).toBe('New Feature');
   });
   ```

### Language Switching

**Context Implementation:**
```typescript
// Language switching is handled by I18nProvider
const { language, setLanguage } = useI18n();

// Switch language
setLanguage('en'); // or 'zh'
```

**Persistence:**
- Language preference is stored in localStorage
- Automatically restored on page reload
- Default language: Chinese (zh)

### Performance Considerations

- **Lazy Loading**: Translation modules are imported statically (no lazy loading needed for current scale)
- **Bundle Size**: Keep translation strings concise but descriptive
- **Caching**: Translations are cached in React context, no re-fetching needed

## Migration Guide

### Converting Hardcoded Text

**Before (âŒ):**
```typescript
<button>å„²å­˜</button>
<span>æœƒè«‡æ¦‚è¦½</span>
alert('å„²å­˜æˆåŠŸï¼');
```

**After (âœ…):**
```typescript
const { t } = useI18n();

<button>{t('common.save')}</button>
<span>{t('sessions.overview')}</span>
alert(t('common.saveSuccess'));
```

### Handling Dynamic Content

**Before (âŒ):**
```typescript
<span>ä¸Šå‚³æˆåŠŸï¼å·²å»ºç«‹ {segments.length} å€‹ç‰‡æ®µ</span>
```

**After (âœ…):**
```typescript
<span>{t('sessions.uploadSuccess', { count: segments.length })}</span>
```

### Error Messages and Alerts

**Before (âŒ):**
```typescript
alert('å„²å­˜è§’è‰²åˆ†é…å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
```

**After (âœ…):**
```typescript
alert(t('sessions.saveRoleError'));
```

**Remember: i18n is not optional - it's a core requirement for all user-facing features.**