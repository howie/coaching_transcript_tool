# AssemblyAI é€å­—ç¨¿è¬›è€…é‚Šç•Œå¹³æ»‘èˆ‡ä¸­æ–‡æ¨™é»ä¿®å¾©

## åŠŸèƒ½æ¦‚è¿°

é‡å° AssemblyAI è½‰éŒ„çµæœé€²è¡Œå¾Œè™•ç†å„ªåŒ–ï¼Œä½¿ç”¨ **LeMUR (Large Language Model)** æ™ºèƒ½è™•ç†ä¸­æ–‡èªéŸ³è½‰éŒ„å•é¡Œï¼š
1. **è¬›è€…äº¤æ¥é»éŒ¯èª¤ä¿®æ­£**ï¼šAI æ™ºèƒ½è­˜åˆ¥è¬›è€…é‚Šç•Œä¸¦ä¿®æ­£åˆ†é…éŒ¯èª¤
2. **ä¸­æ–‡æ¨™é»ç¬¦è™Ÿä¿®å¾©**ï¼šä¾ä¸­æ–‡è¦å‰‡é‡åšå¥ç•Œèˆ‡æ¨™é»ï¼Œä¿æŒèªæ„å®Œæ•´
3. **æ‰¹æ¬¡è™•ç†æ¶æ§‹**ï¼šæ”¯æ´è¶…é•·é€å­—ç¨¿çš„åˆ†æ®µè™•ç†ï¼Œé¿å… API é™åˆ¶
4. **æ™‚é–“æˆ³ä¿ç•™**ï¼šç¶­æŒåŸå§‹æ™‚é–“è³‡è¨Šèˆ‡è¬›è€…è³‡è¨Šçš„æº–ç¢ºæ€§

## å•†æ¥­åƒ¹å€¼

- **æå‡è½‰éŒ„å“è³ª**ï¼šæ¸›å°‘äººå·¥æ ¡å°å·¥ä½œé‡ 70-90%ï¼ˆæå‡è‡ªåŸæœ¬ 60-80%ï¼‰
- **æ”¹å–„ç”¨æˆ¶é«”é©—**ï¼šç”¢ç”Ÿæ›´è‡ªç„¶ã€å¯è®€çš„ä¸­æ–‡é€å­—ç¨¿
- **ç¯€çœæˆæœ¬**ï¼šé™ä½å¾ŒæœŸç·¨è¼¯æ™‚é–“ï¼Œæé«˜ç”Ÿç”¢æ•ˆç‡
- **ç«¶çˆ­å„ªå‹¢**ï¼šæä¾›æ¥­ç•Œé ˜å…ˆçš„ AI é©…å‹•ä¸­æ–‡èªéŸ³è½‰éŒ„å“è³ª

## æŠ€è¡“æ¶æ§‹

```
AssemblyAI Raw Transcript
         â†“
LeMUR Speaker Identification (AI)
         â†“
Batch Processing (é¿å… API é™åˆ¶)
         â†“
LeMUR Punctuation Enhancement (AI)
         â†“
Traditional Chinese Conversion
         â†“
Clean, Readable Segments
         â†“
Database Persistence
```

## é–‹ç™¼ç‹€æ…‹

### âœ… å·²å®Œæˆéšæ®µ
- **LeMUR Integration**: å®Œæ•´æ•´åˆ AssemblyAI LeMUR é€²è¡Œ AI é©…å‹•çš„é€å­—ç¨¿è™•ç†
- **Batch Processing**: å¯¦ç¾åˆ†æ‰¹è™•ç†æ¶æ§‹ï¼Œæ”¯æ´è¶…é•·é€å­—ç¨¿ï¼ˆ>7000 å­—ï¼‰
- **Speaker Identification**: AI æ™ºèƒ½è¬›è€…è­˜åˆ¥èˆ‡é‚Šç•Œä¿®æ­£
- **Punctuation Enhancement**: ä¸­æ–‡æ¨™é»ç¬¦è™Ÿæ™ºèƒ½ä¿®å¾©
- **Concurrent Processing**: ä¸¦ç™¼è™•ç†å¤šå€‹æ‰¹æ¬¡ï¼Œæå‡æ•ˆèƒ½
- **Database Integration**: è™•ç†å¾Œçš„ segments è‡ªå‹•å„²å­˜è‡³è³‡æ–™åº«
- **Auto-smoothing**: ä¸­æ–‡è½‰éŒ„å®Œæˆå¾Œè‡ªå‹•åŸ·è¡Œå„ªåŒ–

### ğŸš§ é–‹ç™¼ä¸­åŠŸèƒ½
- **Frontend UI**: Dev-only ä»‹é¢ï¼Œæ”¯æ´è‡ªå®šç¾© system prompts
- **Error Recovery**: æ‰¹æ¬¡å¤±æ•—æ™‚çš„ fallback æ©Ÿåˆ¶
- **Performance Optimization**: é©æ‡‰æ€§æ‰¹æ¬¡å¤§å°èª¿æ•´

### ğŸ“‹ åŸè¦åŠƒéšæ®µï¼ˆå·²ç”¨ LeMUR å–ä»£ï¼‰
- ~~Epic 1: Speaker Boundary Smoothing~~ â†’ å·²ç”¨ LeMUR AI å–ä»£
- ~~Epic 2: Chinese Punctuation Repair~~ â†’ å·²ç”¨ LeMUR AI å–ä»£
- ~~Epic 3: API Integration~~ â†’ å·²å®Œæˆ
- ~~Epic 4: LeMUR Enhancement~~ â†’ å·²å®Œæˆä¸¦æ“´å±•

## æŠ€è¡“è¦æ ¼

### LeMUR è™•ç†æ¶æ§‹

**ä¸»è¦çµ„ä»¶ï¼š**
- `LeMURTranscriptSmoother`: æ ¸å¿ƒæœå‹™é¡åˆ¥
- `_improve_punctuation_batch_with_lemur()`: åˆ†æ‰¹æ¨™é»ä¿®å¾©
- `_correct_speakers_with_lemur()`: AI è¬›è€…è­˜åˆ¥
- `_process_punctuation_batch()`: å–®æ‰¹æ¬¡è™•ç†é‚è¼¯

**æ‰¹æ¬¡è™•ç†ç­–ç•¥ï¼š**
```python
# é©æ‡‰æ€§æ‰¹æ¬¡å¤§å°
if total_chars > 15000:    # å¤§å‹é€å­—ç¨¿
    max_batch_chars = 2500, max_batch_size = 8
elif total_chars > 8000:   # ä¸­å‹é€å­—ç¨¿  
    max_batch_chars = 3000, max_batch_size = 10
else:                      # å°å‹é€å­—ç¨¿
    max_batch_chars = 4000, max_batch_size = 15

# ä¸¦ç™¼è™•ç†ï¼ˆæœ€å¤š 3 å€‹æ‰¹æ¬¡åŒæ™‚è™•ç†ï¼‰
max_concurrent_batches = min(3, len(batches))
```

### è¼¸å…¥æ ¼å¼
```python
# AssemblyAI segments format
segments: List[Dict] = [
    {
        "speaker": "Speaker_A",
        "text": "åŸå§‹è½‰éŒ„æ–‡å­—",
        "start": 1234,    # milliseconds
        "end": 5678       # milliseconds
    }
]
```

### è¼¸å‡ºæ ¼å¼
```python
# TranscriptSegment format  
segments: List[TranscriptSegment] = [
    TranscriptSegment(
        start=1234,       # milliseconds (int)
        end=5678,         # milliseconds (int)
        speaker="æ•™ç·´",    # AI corrected speaker
        text="ä¿®æ­£å¾Œçš„ä¸­æ–‡åˆ†å¥æ–‡æœ¬ï¼Œå«é©ç•¶æ¨™é»ç¬¦è™Ÿã€‚"
    )
]
```

## å“è³ªæ¨™æº–

- **æ­£ç¢ºæ€§**ï¼šAI é©…å‹•è¬›è€…é‚Šç•Œä¿®æ­£æº–ç¢ºç‡ > 95%ï¼ˆæå‡è‡ªåŸæœ¬ 90%ï¼‰
- **ç©©å®šæ€§**ï¼šæ‰¹æ¬¡è™•ç† fallback æ©Ÿåˆ¶ï¼Œç¢ºä¿ä¸æœƒå®Œå…¨å¤±æ•—
- **å¯è§€æ¸¬æ€§**ï¼šè©³ç´°çš„æ‰¹æ¬¡è™•ç†æ—¥èªŒå’Œ debug è³‡è¨Š
- **èªæ„ä¿çœŸ**ï¼šAI åƒ…æ”¹å–„æ¨™é»å’Œè¬›è€…ï¼Œä¸ä¿®æ”¹åŸå§‹èªå¥å…§å®¹
- **æ•ˆèƒ½**ï¼šæ”¯æ´è¶…é•·é€å­—ç¨¿ï¼ˆ15000+ å­—ï¼‰ï¼Œæ‰¹æ¬¡ä¸¦ç™¼è™•ç†
- **å¯é æ€§**ï¼šæ¯å€‹æ‰¹æ¬¡ç¨ç«‹è™•ç†ï¼Œå–®ä¸€å¤±æ•—ä¸å½±éŸ¿æ•´é«”çµæœ

## å¯¦ç¾ç´°ç¯€

### è‡ªå‹•è§¸ç™¼æ¢ä»¶
```python
# åœ¨ assemblyai_stt.py ä¸­è‡ªå‹•åŸ·è¡Œ
should_smooth = (
    language_code and 
    any(lang in language_code for lang in ["zh", "cmn"]) and
    len(segments) > 0
)
```

### é—œéµæª”æ¡ˆä½ç½®
- **æ ¸å¿ƒæœå‹™**ï¼š`src/coaching_assistant/services/lemur_transcript_smoother.py`
- **API ç«¯é»**ï¼š`src/coaching_assistant/api/transcript_smoothing.py`
- **å‰ç«¯ç•Œé¢**ï¼š`apps/web/app/dashboard/sessions/[id]/page.tsx`
- **è‡ªå‹•è§¸ç™¼**ï¼š`src/coaching_assistant/services/assemblyai_stt.py`
- **è³‡æ–™åº«å„²å­˜**ï¼š`src/coaching_assistant/tasks/transcription_tasks.py`

## å°èˆª

- [ç”¨æˆ¶æ•…äº‹ç¸½è¦½](./user-stories.md)
- [å¯¦æ–½è·¯ç·šåœ–](./implementation-roadmap.md)
- [æŠ€è¡“è¦æ ¼](./technical/)
- [æ¸¬è©¦æ¡ˆä¾‹](./test-cases.md)

## ç›¸é—œè³‡æº

- [AssemblyAI API æ–‡æª”](https://www.assemblyai.com/docs/)
- [ä¸­æ–‡æ¨™é»è¦ç¯„](https://www.moe.gov.tw/cp-1-language/)
- [ç¾æœ‰ STT æ¶æ§‹](../../architecture/stt.md)