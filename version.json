{
  "version": "2.25.5",
  "displayVersion": "v2.25.5",
  "description": "Production Fix: Configure ECPay payment gateway environment variables",
  "releaseDate": "2025-10-04",
  "releaseNotes": "Fix subscription authorization failures by configuring ECPay payment gateway.\n\nRoot Cause:\n- Subscription authorization endpoint (POST /v1/subscriptions/authorize) failing with HTTP 500\n- ECPay payment gateway environment variables missing in production\n- All plan upgrades (STUDENT, PRO, ENTERPRISE) affected\n- Error: 'Failed to create payment authorization'\n\nInvestigation:\n- Database query confirmed user plan enum values are correct (lowercase)\n- ECPay tables (ecpay_credit_authorizations) exist and accessible\n- Terraform configuration had ECPay variables defined but not applied to Render\n- Code logic for plan resolution and authorization working correctly\n\nSolution:\n- Applied ECPay environment variables to production Render service:\n  * ECPAY_MERCHANT_ID: 3468076\n  * ECPAY_HASH_KEY: hLrOGBgCxYqQQx6g\n  * ECPAY_HASH_IV: ruMwFbIxllozmtHG\n  * ECPAY_ENVIRONMENT: production\n- Variables sourced from terraform/environments/production/terraform.tfvars\n- Deployment triggered automatically via Render MCP\n\nNew Tools Created (for future use):\n✅ Emergency database repair script (scripts/database/emergency_fix_user_plan_enum.py)\n✅ Migration validator for enum safety (scripts/database/validate_enum_migration.py)\n✅ Two-phase enum migration templates (alembic/versions/6d160a319b2c, 5572c099bcd1)\n✅ Integration tests for enum migrations (tests/integration/test_enum_migrations.py)\n✅ Production incident documentation (docs/issues/production-subscription-auth-enum-failure.md)\n\nFiles Changed:\n- Production Render service environment variables (via MCP)\n- scripts/database/emergency_fix_user_plan_enum.py (new)\n- scripts/database/validate_enum_migration.py (new)\n- alembic/versions/6d160a319b2c_repair_user_plan_enum_phase1_add_values.py (new)\n- alembic/versions/5572c099bcd1_repair_user_plan_enum_phase2_migrate_data.py (new)\n- tests/integration/test_enum_migrations.py (new)\n- docs/issues/production-subscription-auth-enum-failure.md (new)\n- version.json\n\nBenefits:\n✅ Subscription authorization now works for all plans\n✅ ECPay payment gateway properly configured\n✅ Production-grade safety tools for future enum migrations\n✅ Comprehensive incident documentation for knowledge base",
  "author": "Coachly Team"
}
